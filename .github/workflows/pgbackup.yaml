name: PostgreSQL Backup Test

on:
  schedule:
    - cron: '0 23 * * *'  # Ez UTC 23:00, magyar idÅ‘ szerint pont Ã©jfÃ©l
  workflow_dispatch:
  push:
    paths:
      - 'sql_scripts/db_backup/**'

jobs:
  db-dump-test:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Repo klÃ³nozÃ¡sa
        uses: actions/checkout@v3

      - name: ğŸ˜ PostgreSQL telepÃ­tÃ©se
        run: |
          sudo apt update
          sudo apt install -y postgresql postgresql-contrib

      - name: ğŸ—ƒï¸ AdatbÃ¡zis lÃ©trehozÃ¡sa teszthez
        run: |
          sudo -u postgres createdb receptek_utf8_test

      - name: ğŸ“‚ Dump visszatÃ¶ltÃ©se teszt adatbÃ¡zisba
        run: |
          sudo -u postgres psql -d receptek_utf8_test -f sql_scripts/db_backup/receptek_utf8_dump.sql

      - name: ğŸ§¹ TakarÃ­tÃ¡s
        run: |
          sudo -u postgres dropdb receptek_utf8_test

  notify-on-failure:
    if: failure()
    runs-on: ubuntu-latest
    steps:
      - name: âŒ Send failure notification
        run: |
          echo "ğŸ”´ PostgreSQL backup or restore failed."
          echo "Check logs: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"

