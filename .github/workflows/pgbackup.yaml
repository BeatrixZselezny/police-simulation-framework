name: PostgreSQL Dump Teszt

on:
  push:
    paths:
      - 'sql_scripts/db_backup/**'
  schedule:
    - cron: '0 23 * * *' # Ez UTC 23:00, azaz magyar idÅ‘ szerint pont Ã©jfÃ©l!

jobs:
  db-dump-test:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Repo klÃ³nozÃ¡sa
        uses: actions/checkout@v3

      - name: ğŸ˜ PostgreSQL telepÃ­tÃ©se
        run: |
          sudo apt update
          sudo apt install -y postgresql postgresql-contrib

      - name: ğŸ”„ AdatbÃ¡zis lÃ©trehozÃ¡sa teszthez
        run: |
          sudo -u postgres createdb receptek_utf8_test

      - name: ğŸ’¾ Dump visszatÃ¶ltÃ©se teszt adatbÃ¡zisba
        run: |
          sudo -u postgres psql -d receptek_utf8_test -f sql_scripts/db_backup/receptek_utf8_dump.sql

      - name: ğŸ§¹ TakarÃ­tÃ¡s
        run: |
          sudo -u postgres dropdb receptek_utf8_test

  notify-on-failure:
  if: failure()
  runs-on: ubuntu-latest
  steps:
    - name: âŒ Send failure notification
      run: |
        echo "ğŸ”´ PostgreSQL backup or restore failed. Check logs here: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"

